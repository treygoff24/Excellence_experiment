# Ticket 116 â€” Config schema & prompt adapter

Date: 2025-09-09

Changes
- Updated `config/schema.py`:
  - Added backend fields: `backend`, `local_engine`, `local_endpoint`, `local_model`, `max_concurrent_requests`, optional `tokenizer` with validation.
  - Normalizes `local_endpoint` via env/home expansion.
- Added `scripts/prompt_adapter.py`:
  - Renders either `messages=[{role, content}...]` or single `prompt` string.
  - Uses config-selected prompt set and task instructions (`open_book`/`closed_book`).
  - Selects `max_new_tokens` per task type and passes through `stop` if configured.
  - Includes `--check` to verify control/treatment differ only in system prompt while user message is identical.

Notes
- Existing `scripts/audit_prompts.py` already provides prompt length auditing; left intact.
- No orchestration/engine networking changes in this ticket (per scope).

Quick test
```bash
python -m scripts.prompt_adapter --question "Who wrote The Hobbit?" --type closed --condition control --check
```

